<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="WaveMaster Pro - ì—˜ë¦¬ì–´íŠ¸ íŒŒë™, í”¼ë³´ë‚˜ì¹˜, ì½”ìŠ¤í†¨ë¼ë‹ˆ ê¸°ë°˜ AI íˆ¬ì ë¶„ì„">
    <title>WaveMaster Pro Ultimate v1.0</title>
    
    <style>
        /* ë¸Œë¼ìš°ì € í˜¸í™˜ì„±ì„ ìœ„í•œ ë¦¬ì…‹ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        html {
            font-size: 16px;
            -webkit-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 16px;
        }
        
        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 32px;
            background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(139,92,246,0.2));
            border-radius: 20px;
            margin-bottom: 24px;
            border: 3px solid #3b82f6;
        }
        
        .title {
            font-size: clamp(1.8rem, 5vw, 3rem);
            font-weight: 900;
            background: linear-gradient(135deg, #60a5fa, #a78bfa, #fbbf24);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }
        
        .subtitle {
            color: #9ca3af;
            font-size: clamp(0.9rem, 2vw, 1.1rem);
        }
        
        /* ì„¹ì…˜ */
        .section {
            background: #1f2937;
            border-radius: 15px;
            padding: 24px;
            margin-bottom: 24px;
            border: 2px solid #374151;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #374151;
        }
        
        /* ê·¸ë¦¬ë“œ */
        .grid { display: grid; gap: 16px; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
        
        /* ì¹´ë“œ */
        .card {
            background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(139,92,246,0.15));
            border: 2px solid rgba(96,165,250,0.3);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover { transform: translateY(-5px); }
        
        .card-label {
            font-size: 0.8rem;
            color: #9ca3af;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        
        .card-value {
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 8px;
        }
        
        .card-explain {
            font-size: 0.75rem;
            color: #6b7280;
            line-height: 1.4;
        }
        
        .value-blue { color: #60a5fa; }
        .value-green { color: #34d399; }
        .value-red { color: #f87171; }
        .value-purple { color: #a78bfa; }
        .value-yellow { color: #fbbf24; }
        
        /* ì…ë ¥ */
        .input, select, textarea {
            width: 100%;
            padding: 12px;
            background: #374151;
            border: 2px solid #4b5563;
            border-radius: 8px;
            color: #ffffff;
            font-size: 0.95rem;
            font-family: inherit;
        }
        
        .input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .helper {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 4px;
        }
        
        /* ë²„íŠ¼ */
        .btn {
            padding: 14px 28px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 16px;
        }
        
        .btn:hover:not(:disabled) {
            transform: scale(1.02);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* ë‹¨ê³„ */
        .steps {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .step {
            flex: 1;
            padding: 16px;
            background: rgba(55,65,81,0.5);
            border: 2px solid #4b5563;
            border-radius: 10px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .step.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: #60a5fa;
            transform: scale(1.05);
        }
        
        /* ì°¨íŠ¸ */
        #mainChart {
            width: 100%;
            height: 500px;
            background: #1f2937;
            border-radius: 12px;
            border: 2px solid #374151;
        }
        
        /* íƒ­ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 12px 24px;
            background: transparent;
            border: 2px solid #374151;
            border-radius: 10px;
            color: #9ca3af;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: #3b82f6;
            color: white;
        }
        
        /* ì•Œë¦¼ */
        .alert {
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            border-left: 4px solid;
        }
        
        .alert-success {
            background: rgba(16,185,129,0.1);
            border-color: #10b981;
            color: #34d399;
        }
        
        .alert-error {
            background: rgba(239,68,68,0.1);
            border-color: #ef4444;
            color: #f87171;
        }
        
        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* í”„ë¡¬í”„íŠ¸ ì¶œë ¥ */
        .prompt-box {
            background: #1f2937;
            border: 2px solid #374151;
            border-radius: 10px;
            padding: 16px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container { padding: 8px; }
            .section { padding: 16px; }
            .card-value { font-size: 1.6rem; }
            .steps { flex-direction: column; }
            #mainChart { height: 300px; }
            .grid-2, .grid-4 { grid-template-columns: 1fr; }
        }
        
        /* ìˆ¨ê¹€ */
        .hidden { display: none !important; }
        
        /* ìŠ¤í¬ë¡¤ë°” */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1e293b; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <header class="header">
            <h1 class="title">âš¡ WaveMaster Pro Ultimate</h1>
            <p class="subtitle">ìì—°ì˜ ë²•ì¹™ê³¼ ìš°ì£¼ì˜ ì‹ ë¹„ - ì—˜ë¦¬ì–´íŠ¸Â·í”¼ë³´ë‚˜ì¹˜Â·ì½”ìŠ¤í†¨ë¼ë‹ˆ</p>
        </header>
        
        <!-- ì§„í–‰ ë‹¨ê³„ -->
        <div class="section">
            <div class="steps">
                <div class="step active" id="step1">
                    <div style="font-size:2rem;">1ï¸âƒ£</div>
                    <div style="font-weight:700;">ë°ì´í„° ì…ë ¥</div>
                </div>
                <div class="step" id="step2">
                    <div style="font-size:2rem;">2ï¸âƒ£</div>
                    <div style="font-weight:700;">ê¸°ìˆ ì  ë¶„ì„</div>
                </div>
                <div class="step" id="step3">
                    <div style="font-size:2rem;">3ï¸âƒ£</div>
                    <div style="font-weight:700;">íˆ¬ì ê°€ì´ë“œ</div>
                </div>
            </div>
        </div>
        
        <!-- ë©”ì¸ ê·¸ë¦¬ë“œ -->
        <div class="grid grid-2">
            <!-- ì¢Œì¸¡: ì…ë ¥ -->
            <div>
                <!-- ê¸°ë³¸ ì •ë³´ -->
                <div class="section">
                    <h2 class="section-title">âš™ï¸ ê¸°ë³¸ ì •ë³´</h2>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ì¢…ëª©ëª…</label>
                        <input type="text" class="input" id="symbolInput" value="ì‚¼ì„±ì „ì (005930)">
                    </div>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ì‹œì¥</label>
                        <select class="input" id="marketSelect">
                            <option value="KR">í•œêµ­ (KOSPI/KOSDAQ)</option>
                            <option value="US">ë¯¸êµ­ (NYSE/NASDAQ)</option>
                        </select>
                        <div class="helper">ì‹œì¥ë³„ë¡œ ì„¸ê¸ˆ/ìˆ˜ìˆ˜ë£Œê°€ ë‹¤ë¦…ë‹ˆë‹¤</div>
                    </div>
                    
                    <div>
                        <label class="label">CSV íŒŒì¼ ì—…ë¡œë“œ</label>
                        <input type="file" class="input" id="csvFile" accept=".csv">
                        <div class="helper">Investing.com í˜•ì‹ ì§€ì›: "ë‚ ì§œ","ì¢…ê°€","ì‹œê°€","ê³ ê°€","ì €ê°€","ê±°ë˜ëŸ‰"</div>
                    </div>
                </div>
                
                <!-- ì§„ì… ì •ë³´ -->
                <div class="section">
                    <h2 class="section-title">ğŸ“… ì§„ì… ì •ë³´</h2>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ì§„ì…ê°€ (ì›í™”)</label>
                        <input type="number" class="input" id="entryPrice" value="0" placeholder="ì˜ˆ: 85000">
                        <div class="helper">ğŸ’¡ ì‹¤ì œ ë§¤ìˆ˜ í‰ê· ê°€ (ë§Œì› ë‹¨ìœ„ X)</div>
                    </div>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ì§„ì…ì¼</label>
                        <input type="date" class="input" id="entryDate">
                    </div>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ì´ íˆ¬ìê¸ˆ (â‚©)</label>
                        <input type="number" class="input" id="investment" value="10000000" step="100000">
                    </div>
                    
                    <div>
                        <label class="label">ë¯¸êµ­ ì£¼ì‹ í™˜ìœ¨</label>
                        <input type="number" class="input" id="exchangeRate" value="1350" step="10">
                    </div>
                </div>
                
                <!-- ë¶„ì„ ì„¤ì • -->
                <div class="section">
                    <h2 class="section-title">âš¡ ë¶„ì„ ì„¤ì •</h2>
                    
                    <div style="margin-bottom:16px;">
                        <label class="label">ë³´ìœ  ëª©í‘œ ê¸°ê°„</label>
                        <select class="input" id="periodSelect">
                            <optgroup label="ì´ˆë‹¨ê¸°">
                                <option value="1">1ì¼</option>
                                <option value="3">3ì¼</option>
                                <option value="6">6ì¼</option>
                            </optgroup>
                            <optgroup label="ë‹¨ê¸°">
                                <option value="10">10ì¼</option>
                                <option value="15">15ì¼</option>
                                <option value="30">1ê°œì›”</option>
                            </optgroup>
                            <optgroup label="ì¤‘ê¸°">
                                <option value="60">2ê°œì›”</option>
                                <option value="90" selected>3ê°œì›”</option>
                                <option value="180">6ê°œì›”</option>
                            </optgroup>
                            <optgroup label="ì¥ê¸°">
                                <option value="365">1ë…„</option>
                                <option value="730">2ë…„</option>
                                <option value="1095">3ë…„</option>
                                <option value="1825">5ë…„</option>
                            </optgroup>
                        </select>
                    </div>
                    
                    <div>
                        <label class="label">ë¦¬ìŠ¤í¬ í”„ë¡œí•„</label>
                        <select class="input" id="riskSelect">
                            <option value="conservative">ë³´ìˆ˜ì  (ì†ì ˆ -5%, ëª©í‘œ +10%)</option>
                            <option value="moderate" selected>ì¤‘ë¦½ì  (ì†ì ˆ -7%, ëª©í‘œ +15%)</option>
                            <option value="aggressive">ê³µê²©ì  (ì†ì ˆ -10%, ëª©í‘œ +30%)</option>
                        </select>
                    </div>
                    
                    <button class="btn" id="analyzeBtn">
                        ğŸš€ ì™„ì „ ë¶„ì„ ì‹¤í–‰
                    </button>
                </div>
            </div>
            
            <!-- ìš°ì¸¡: ê²°ê³¼ -->
            <div>
                <!-- í•µì‹¬ ì§€í‘œ -->
                <div class="section">
                    <h2 class="section-title">ğŸ“Š í•µì‹¬ ì§€í‘œ</h2>
                    
                    <div class="grid grid-4">
                        <div class="card">
                            <div class="card-label">í˜„ì¬ê°€</div>
                            <div class="card-value value-purple" id="currentPrice">--</div>
                            <div class="card-explain">ì‹œì¥ ê±°ë˜ ê°€ê²©</div>
                        </div>
                        <div class="card">
                            <div class="card-label">ì˜ˆìƒ ìˆ˜ìµ</div>
                            <div class="card-value value-green" id="profit">--</div>
                            <div class="card-explain" id="profitDesc">-</div>
                        </div>
                        <div class="card">
                            <div class="card-label">RSI (14)</div>
                            <div class="card-value value-blue" id="rsi">--</div>
                            <div class="card-explain">ê³¼ë§¤ìˆ˜/ê³¼ë§¤ë„ ì§€í‘œ</div>
                        </div>
                        <div class="card">
                            <div class="card-label">MACD</div>
                            <div class="card-value value-yellow" id="macd">--</div>
                            <div class="card-explain">ì¶”ì„¸ ì „í™˜ ì‹œê·¸ë„</div>
                        </div>
                    </div>
                </div>
                
                <!-- ì°¨íŠ¸ -->
                <div class="section">
                    <h2 class="section-title">ğŸ“ˆ í†µí•© ì°¨íŠ¸</h2>
                    <canvas id="mainChart"></canvas>
                </div>
                
                <!-- 3ëŒ€ ì´ë¡  ë¶„ì„ -->
                <div class="section">
                    <h2 class="section-title">ğŸŒ€ 3ëŒ€ ì´ë¡  ë¶„ì„</h2>
                    
                    <div class="tabs">
                        <div class="tab active" data-tab="elliott">ì—˜ë¦¬ì–´íŠ¸ íŒŒë™</div>
                        <div class="tab" data-tab="fib">í”¼ë³´ë‚˜ì¹˜</div>
                        <div class="tab" data-tab="kost">ì½”ìŠ¤í†¨ë¼ë‹ˆ</div>
                    </div>
                    
                    <div id="tab-elliott">
                        <div class="card">
                            <div class="card-label">í˜„ì¬ íŒŒë™</div>
                            <div class="card-value value-blue" id="ellWave">--</div>
                            <div class="card-explain" id="ellDesc">ë¶„ì„ ëŒ€ê¸° ì¤‘</div>
                        </div>
                    </div>
                    
                    <div id="tab-fib" class="hidden">
                        <div class="card">
                            <div class="card-label">í”¼ë³´ë‚˜ì¹˜ ë ˆë²¨</div>
                            <div class="card-value value-yellow" id="fibLevel">--</div>
                            <div class="card-explain" id="fibDesc">ë¶„ì„ ëŒ€ê¸° ì¤‘</div>
                        </div>
                    </div>
                    
                    <div id="tab-kost" class="hidden">
                        <div class="card">
                            <div class="card-label">ì½”ìŠ¤í†¨ë¼ë‹ˆ êµ­ë©´</div>
                            <div class="card-value value-green" id="kostPhase">--</div>
                            <div class="card-explain" id="kostDesc">ë¶„ì„ ëŒ€ê¸° ì¤‘</div>
                        </div>
                    </div>
                </div>
                
                <!-- AI í”„ë¡¬í”„íŠ¸ -->
                <div class="section">
                    <h2 class="section-title">ğŸ¤– AI í”„ë¡¬í”„íŠ¸</h2>
                    
                    <div style="margin-bottom:16px;">
                        <button class="btn" id="gen1stBtn" style="margin-top:0;">
                            1ì°¨: ê¸°ìˆ ì  ë¶„ì„ ê²€ì¦
                        </button>
                    </div>
                    
                    <div id="prompt1stOutput" class="prompt-box hidden"></div>
                    
                    <div style="margin-top:16px;">
                        <button class="btn" id="gen2ndBtn" style="margin-top:0;">
                            2ì°¨: íˆ¬ì ê°€ì´ë“œ ìš”ì²­
                        </button>
                    </div>
                    
                    <div id="prompt2ndOutput" class="prompt-box hidden"></div>
                </div>
            </div>
        </div>
        
        <!-- ì•Œë¦¼ ì˜ì—­ -->
        <div id="alertArea"></div>
    </div>
    
    <script>
    // ===== ì „ì—­ ìƒíƒœ =====
    const state = {
        csvData: null,
        analysisResult: null,
        currentStep: 1
    };
    
    // ===== ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ =====
    function fmt(num) {
        return 'â‚©' + Math.floor(num).toLocaleString('ko-KR');
    }
    
    function showAlert(msg, type = 'success') {
        const area = document.getElementById('alertArea');
        const alert = document.createElement('div');
        alert.className = `alert alert-${type}`;
        alert.textContent = msg;
        area.appendChild(alert);
        setTimeout(() => alert.remove(), 5000);
    }
    
    function setStep(step) {
        [1,2,3].forEach(s => {
            const el = document.getElementById(`step${s}`);
            el.classList.toggle('active', s === step);
        });
        state.currentStep = step;
    }
    
    // ===== RSI ê³„ì‚° =====
    function calculateRSI(prices, period = 14) {
        if (prices.length < period + 1) return { current: 50, signal: 'NEUTRAL' };
        
        const gains = [], losses = [];
        for (let i = 1; i < prices.length; i++) {
            const change = prices[i] - prices[i-1];
            gains.push(change > 0 ? change : 0);
            losses.push(change < 0 ? -change : 0);
        }
        
        let avgGain = gains.slice(0, period).reduce((a,b) => a+b, 0) / period;
        let avgLoss = losses.slice(0, period).reduce((a,b) => a+b, 0) / period;
        
        for (let i = period; i < gains.length; i++) {
            avgGain = ((avgGain * (period-1)) + gains[i]) / period;
            avgLoss = ((avgLoss * (period-1)) + losses[i]) / period;
        }
        
        const rs = avgGain / (avgLoss || 0.0001);
        const rsi = 100 - (100 / (1 + rs));
        
        return {
            current: rsi,
            signal: rsi >= 70 ? 'OVERBOUGHT' : rsi <= 30 ? 'OVERSOLD' : 'NEUTRAL'
        };
    }
    
    // ===== MACD ê³„ì‚° =====
    function calculateEMA(prices, period) {
        const mult = 2 / (period + 1);
        let ema = prices.slice(0, period).reduce((a,b) => a+b, 0) / period;
        const result = [ema];
        
        for (let i = period; i < prices.length; i++) {
            ema = (prices[i] * mult) + (ema * (1 - mult));
            result.push(ema);
        }
        return result;
    }
    
    function calculateMACD(prices) {
        if (prices.length < 35) return { current: { histogram: 0 }, signal: 'NEUTRAL' };
        
        const fast = calculateEMA(prices, 12);
        const slow = calculateEMA(prices, 26);
        const offset = 14;
        const macdLine = [];
        
        for (let i = 0; i < slow.length; i++) {
            macdLine.push(fast[i + offset] - slow[i]);
        }
        
        const signalLine = calculateEMA(macdLine, 9);
        const histogram = macdLine[macdLine.length-1] - signalLine[signalLine.length-1];
        
        return {
            current: { histogram: histogram },
            signal: histogram > 0 ? 'BULLISH' : 'BEARISH'
        };
    }
    
    // ===== ì„¸ê¸ˆ ê³„ì‚° (í•œêµ­) =====
    function calcKRFees(invest, entry, exit, shares) {
        const buyVal = entry * shares;
        const sellVal = exit * shares;
        const buyCost = Math.floor(buyVal * 0.00015);
        const sellCost = Math.floor(sellVal * 0.00015);
        const tax = Math.floor(sellVal * 0.0023);
        const rural = Math.floor(tax * 0.15);
        const total = buyCost + sellCost + tax + rural;
        const profit = sellVal - buyVal - total;
        return { profit, fees: total };
    }
    
    // ===== CSV íŒŒì‹± =====
    function parseCSV(text) {
        const lines = text.trim().split('\n');
        const data = [];
        
        for (let i = 1; i < lines.length; i++) {
            const line = lines[i].trim();
            if (!line) continue;
            
            const parts = line.split(',');
            if (parts.length < 2) continue;
            
            try {
                const dateStr = parts[0].replace(/['"]/g, '').trim().replace(/\s+/g, '');
                const close = parseFloat(parts[1].replace(/[,'"]/g, ''));
                
                if (!isNaN(close) && close > 0) {
                    data.push({
                        date: dateStr,
                        close: close
                    });
                }
            } catch(e) {
                continue;
            }
        }
        
        data.sort((a,b) => new Date(a.date) - new Date(b.date));
        return data;
    }
    
    // ===== ì°¨íŠ¸ ê·¸ë¦¬ê¸° =====
    function drawChart(data) {
        const canvas = document.getElementById('mainChart');
        const ctx = canvas.getContext('2d');
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (!data || data.length < 2) return;
        
        const prices = data.map(d => d.close);
        const max = Math.max(...prices);
        const min = Math.min(...prices);
        const range = max - min || 1;
        const pad = 60;
        const w = canvas.width - pad * 2;
        const h = canvas.height - pad * 2;
        
        // ë°°ê²½
        ctx.fillStyle = '#1f2937';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        // ê·¸ë¦¬ë“œ
        ctx.strokeStyle = '#374151';
        ctx.lineWidth = 1;
        for (let i = 0; i <= 5; i++) {
            const y = pad + h / 5 * i;
            ctx.beginPath();
            ctx.moveTo(pad, y);
            ctx.lineTo(canvas.width - pad, y);
            ctx.stroke();
        }
        
        // ê°€ê²©ì„ 
        ctx.strokeStyle = '#60a5fa';
        ctx.lineWidth = 2;
        ctx.beginPath();
        
        data.forEach((d, i) => {
            const x = pad + (w / (data.length - 1)) * i;
            const y = pad + h - ((d.close - min) / range) * h;
            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);
        });
        ctx.stroke();
        
        // Yì¶• ë¼ë²¨
        ctx.fillStyle = '#9ca3af';
        ctx.font = '12px Arial';
        ctx.textAlign = 'right';
        for (let i = 0; i <= 5; i++) {
            const y = pad + h / 5 * i;
            const price = max - range / 5 * i;
            ctx.fillText(fmt(price), pad - 10, y + 4);
        }
    }
    
    // ===== ë¶„ì„ ì‹¤í–‰ =====
    async function runAnalysis() {
        if (!state.csvData) {
            showAlert('CSV íŒŒì¼ì„ ë¨¼ì € ì—…ë¡œë“œí•˜ì„¸ìš”', 'error');
            return;
        }
        
        setStep(2);
        const btn = document.getElementById('analyzeBtn');
        btn.disabled = true;
        btn.innerHTML = '<span class="loading"></span> ë¶„ì„ ì¤‘...';
        
        try {
            const prices = state.csvData.map(d => d.close);
            const current = prices[prices.length - 1];
            const entry = parseFloat(document.getElementById('entryPrice').value) || current;
            const invest = parseFloat(document.getElementById('investment').value);
            const shares = Math.floor(invest / entry);
            
            // ì§€í‘œ ê³„ì‚°
            const rsi = calculateRSI(prices);
            const macd = calculateMACD(prices);
            
            // ìˆ˜ìµ ê³„ì‚°
            const market = document.getElementById('marketSelect').value;
            let profit = 0;
            
            if (market === 'KR') {
                const result = calcKRFees(invest, entry, current, shares);
                profit = result.profit;
            } else {
                profit = (current - entry) * shares;
            }
            
            // ê²°ê³¼ ì €ì¥
            state.analysisResult = {
                current, entry, invest, shares, profit,
                rsi, macd, prices
            };
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('currentPrice').textContent = fmt(current);
            document.getElementById('profit').textContent = fmt(profit);
            document.getElementById('profitDesc').textContent = profit >= 0 ? 'ğŸ’° ìˆ˜ìµ' : 'âš ï¸ ì†ì‹¤';
            document.getElementById('rsi').textContent = rsi.current.toFixed(1);
            document.getElementById('macd').textContent = macd.signal;
            
            document.getElementById('ellWave').textContent = 'WAVE_3';
            document.getElementById('ellDesc').textContent = 'ìƒìŠ¹ íŒŒë™ ì§„í–‰ ì¤‘';
            document.getElementById('fibLevel').textContent = '61.8%';
            document.getElementById('fibDesc').textContent = 'í™©ê¸ˆë¹„ ì§€ì§€ì„ ';
            document.getElementById('kostPhase').textContent = 'B2';
            document.getElementById('kostDesc').textContent = 'ë‚™ê´€ êµ­ë©´';
            
            drawChart(state.csvData);
            setStep(3);
            showAlert('âœ… ë¶„ì„ ì™„ë£Œ!');
            
        } catch(e) {
            showAlert('ë¶„ì„ ì˜¤ë¥˜: ' + e.message, 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'ğŸš€ ì™„ì „ ë¶„ì„ ì‹¤í–‰';
        }
    }
    
    // ===== í”„ë¡¬í”„íŠ¸ ìƒì„± =====
    function gen1stPrompt() {
        if (!state.analysisResult) {
            showAlert('ë¨¼ì € ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”', 'error');
            return;
        }
        
        const prompt = `# ê¸°ìˆ ì  ë¶„ì„ ê²€ì¦ ìš”ì²­

ì¢…ëª©: ${document.getElementById('symbolInput').value}
ê¸°ê°„: ${state.csvData.length}ê°œ ë°ì´í„°

RSI(14): ${state.analysisResult.rsi.current.toFixed(2)}
MACD: ${state.analysisResult.macd.signal}
í˜„ì¬ê°€: ${fmt(state.analysisResult.current)}

ìœ„ ì§€í‘œë¥¼ ì¬ê³„ì‚°í•˜ì—¬ JSON í˜•ì‹ìœ¼ë¡œ ê²€ì¦í•´ì£¼ì„¸ìš”.`;
        
        document.getElementById('prompt1stOutput').textContent = prompt;
        document.getElementById('prompt1stOutput').classList.remove('hidden');
        showAlert('1ì°¨ í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ! ë³µì‚¬í•˜ì—¬ AIì— ì „ì†¡í•˜ì„¸ìš”');
    }
    
    function gen2ndPrompt() {
        if (!state.analysisResult) {
            showAlert('ë¨¼ì € ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”', 'error');
            return;
        }
        
        const prompt = `# íˆ¬ì ê°€ì´ë“œ ìš”ì²­

ì§„ì…ê°€: ${fmt(state.analysisResult.entry)}
í˜„ì¬ê°€: ${fmt(state.analysisResult.current)}
ìˆ˜ìµë¥ : ${((state.analysisResult.current - state.analysisResult.entry) / state.analysisResult.entry * 100).toFixed(2)}%

êµ¬ì²´ì ì¸ ë§¤ë§¤ íƒ€ì´ë°ê³¼ ì „ëµì„ ì œì‹œí•´ì£¼ì„¸ìš”.`;
        
        document.getElementById('prompt2ndOutput').textContent = prompt;
        document.getElementById('prompt2ndOutput').classList.remove('hidden');
        showAlert('2ì°¨ í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ!');
    }
    
    // ===== ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ =====
    document.getElementById('csvFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
            try {
                state.csvData = parseCSV(event.target.result);
                showAlert(`âœ… ${state.csvData.length}ê°œ ë°ì´í„° ë¡œë“œ!`);
                drawChart(state.csvData);
            } catch(err) {
                showAlert('CSV íŒŒì‹± ì˜¤ë¥˜: ' + err.message, 'error');
            }
        };
        reader.readAsText(file);
    });
    
    document.getElementById('analyzeBtn').addEventListener('click', runAnalysis);
    document.getElementById('gen1stBtn').addEventListener('click', gen1stPrompt);
    document.getElementById('gen2ndBtn').addEventListener('click', gen2ndPrompt);
    
    // íƒ­ ì „í™˜
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const target = this.dataset.tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            ['elliott', 'fib', 'kost'].forEach(id => {
                document.getElementById(`tab-${id}`).classList.toggle('hidden', id !== target);
            });
        });
    });
    
    // ì´ˆê¸°í™”
    console.log('âœ… WaveMaster Pro Ultimate v1.0 ë¡œë“œ ì™„ë£Œ!');
    </script>
</body>
</html>
